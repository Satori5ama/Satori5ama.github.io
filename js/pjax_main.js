(()=>{var p=(t=window.location.pathname,e=!1)=>{let o=t.split("/").filter(s=>(s=s.trim(),s.length>0&&s!=="/"&&s!=="index.html"));return e?o[0]||"/":o[o.length-1]||"/"},v=t=>new Promise(e=>{"onscrollend"in window?(document.addEventListener("scrollend",e,{once:!0}),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})):(t.scrollIntoView({block:"center",inline:"center"}),e())});_$$(".article-entry h1>a.header-anchor, .article-entry h2>a.header-anchor, .article-entry h3>a.header-anchor, .article-entry h4>a.header-anchor, .article-entry h5>a.header-anchor, .article-entry h6>a.header-anchor").forEach(t=>{window.siteConfig.icon_font?t.innerHTML=window.siteConfig.anchor_icon?`&#x${window.siteConfig.anchor_icon};`:window.siteConfig.anchor_icon===!1?"":"&#xe635;":t.innerHTML=window.siteConfig.anchor_icon?`&#x${window.siteConfig.anchor_icon};`:window.siteConfig.anchor_icon===!1?"":"&#xf292;"});_$$(".article-entry img").forEach(t=>{if(t.parentElement?.classList.contains("friend-icon")||t.parentElement?.tagName==="A"||t.classList.contains("no-lightbox"))return;let e=document.createElement("a");e.href?e.href=t.src:e.setAttribute("href",t.src),e.dataset.pswpWidth=t.naturalWidth,e.dataset.pswpHeight=t.naturalHeight,e.target="_blank",e.classList.add("article-gallery-item"),t.parentNode?.insertBefore(e,t),t.parentNode?.removeChild(t),e.appendChild(t)});window.lightboxStatus="ready";window.dispatchEvent(new Event("lightbox:ready"));var c=!1;_$("#main-nav-toggle")?.off("click").on("click",()=>{c||(c=!0,document.body.classList.toggle("mobile-nav-on"),_$("#mask").classList.remove("hide"),setTimeout(()=>{c=!1},300))});_$("#mask")?.off("click").on("click",()=>{c||!document.body.classList.contains("mobile-nav-on")||(document.body.classList.remove("mobile-nav-on"),_$("#mask").classList.add("hide"))});_$$(".sidebar-toc-btn").forEach(t=>{t.off("click").on("click",function(){this.classList.contains("current")||(_$$(".sidebar-toc-btn").forEach(e=>e.classList.add("current")),_$$(".sidebar-common-btn").forEach(e=>e.classList.remove("current")),_$$(".sidebar-toc-sidebar").forEach(e=>e.classList.remove("hidden")),_$$(".sidebar-common-sidebar").forEach(e=>e.classList.add("hidden")))})});_$$(".sidebar-common-btn").forEach(t=>{t.off("click").on("click",function(){this.classList.contains("current")||(_$$(".sidebar-common-btn").forEach(e=>e.classList.add("current")),_$$(".sidebar-toc-btn").forEach(e=>e.classList.remove("current")),_$$(".sidebar-common-sidebar").forEach(e=>e.classList.remove("hidden")),_$$(".sidebar-toc-sidebar").forEach(e=>e.classList.add("hidden")))})});(()=>{let t=p(window.location.pathname);_$$(".sidebar-menu-link-wrap").forEach(e=>{let o=e.querySelector("a")?.getAttribute("href");o&&p(o)===t&&e.classList.add("link-active")})})();_$$(".article-entry img").forEach(t=>{t.classList.contains("lazyload")||(t.classList.add("lazyload"),t.setAttribute("data-src",t.src),t.setAttribute("data-sizes","auto"),t.removeAttribute("src"))});var d=_$(".sidebar-top");d&&(d.style.transition="opacity 1s",d.off("click").on("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.documentElement.scrollTop<10&&(d.style.opacity="0"));var h;h&&window.off("scroll",h);h=()=>{let t=_$(".sidebar-top");document.documentElement.scrollTop<10?t.style.opacity="0":t.style.opacity="1"};window.on("scroll",h);_$$("#mobile-nav #TableOfContents li").forEach(t=>{t.off("click").on("click",()=>{c||!document.body.classList.contains("mobile-nav-on")||(document.body.classList.remove("mobile-nav-on"),_$("#mask").classList.add("hide"))})});_$$("#mobile-nav .sidebar-menu-link-dummy").forEach(t=>{t.off("click").on("click",()=>{c||!document.body.classList.contains("mobile-nav-on")||setTimeout(()=>{document.body.classList.remove("mobile-nav-on"),_$("#mask").classList.add("hide")},200)})});function $(){if(!_$("#sidebar"))return;let t=getComputedStyle(_$("#sidebar")).display==="block"?_$$("#sidebar .sidebar-toc-wrapper li"):_$$("#mobile-nav .sidebar-toc-wrapper li");if(!t.length)return;let e=null,o=(n,i)=>{n.preventDefault();let a=document.getElementById(decodeURI(n.currentTarget.getAttribute("href")).slice(1));e=i,v(a).then(()=>{l(i),e=null})},s=[...t].map((n,i)=>{let a=n.querySelector("a");a.off("click").on("click",b=>o(b,i));let r=document.getElementById(decodeURI(a.getAttribute("href")).slice(1));return r?(r.querySelector("a")?.off("click").on("click",b=>o(b,i)),r):null}),l=n=>{let i=t[n];if(!i||i.classList.contains("current"))return;_$$(".sidebar-toc-wrapper .active").forEach(r=>{r.classList.remove("active","current")}),s.forEach(r=>{r?.classList.remove("active")}),i.classList.add("active","current"),s[n]?.classList.add("active");let a=i.parentNode;for(;!a.matches(".sidebar-toc-sidebar");){if(a.matches("li")){a.classList.add("active");let r=document.getElementById(decodeURI(a.querySelector("a").getAttribute("href").slice(1)));r&&r.classList.add("active")}a=a.parentNode}if(_$(".sidebar-toc-sidebar").classList.contains("hidden")){let r=_$(".sidebar-toc-wrapper");r.scrollTo({top:r.scrollTop+i.offsetTop-r.offsetHeight/2,behavior:"smooth"})}},m=n=>{let i=0,a=n[i];if(a.boundingClientRect.top>0)return i=s.indexOf(a.target),i===0?0:i-1;for(;i<n.length;i++)if(n[i].boundingClientRect.top<=0)a=n[i];else return s.indexOf(a.target);return s.indexOf(a.target)},u=new IntersectionObserver(n=>{let i=m(n)+(window.diffY>0?1:0);e===null&&l(i)},{rootMargin:"0px 0px -100% 0px",threshold:0});s.forEach(n=>{n&&u.observe(n)})}$();_$(".sponsor-button")?.off("click").on("click",()=>{_$(".sponsor-button")?.classList.toggle("active"),_$(".sponsor-tip")?.classList.toggle("active"),_$(".sponsor-qr")?.classList.toggle("active")});var f;f&&document.off("click",f);f=t=>{if(t.target.closest(".share-icon.icon-weixin"))return;let e=_$("#share-weixin");e&&e.classList.contains("active")&&(e.classList.remove("active"),e.addEventListener("transitionend",function o(){e.style.display="none",e.removeEventListener("transitionend",o)},{once:!0}))};document.on("click",f);_$(".share-icon.icon-weixin")?.off("click").on("click",function(t){let e=this.getBoundingClientRect(),o=this.querySelector("#share-weixin");if(e.x-148<0?o.style.left=`-${e.x-10}px`:e.x+172>window.innerWidth?o.style.left=`-${310-window.innerWidth+e.x}px`:o.style.left="-138px",t.target===this){let n=o;if(!n)return;if(!n.classList.contains("active"))n.style.display="block",requestAnimationFrame(()=>{n.classList.add("active")});else{n.classList.remove("active");let i=a=>{a.propertyName==="opacity"&&(n.style.display="none",n.removeEventListener("transitionend",i))};n.addEventListener("transitionend",i)}}if(_$(".share-weixin-canvas").children.length)return;let{cover:s,description:l,title:m,author:u}=window.REIMU_POST;_$("#share-weixin-banner").src=s,_$("#share-weixin-title").innerText=m,_$("#share-weixin-desc").innerText=l.replace(/\s/g," "),_$("#share-weixin-author").innerText="By: "+u,QRCode.toDataURL(window.REIMU_POST.url,function(n,i){if(n){console.error(n);return}_$("#share-weixin-qr").src=i,snapdom.toPng(_$(".share-weixin-dom")).then(a=>{_$(".share-weixin-canvas").appendChild(a)}).catch(()=>{_$("#share-weixin-banner").remove(),snapdom.toPng(_$(".share-weixin-dom")).then(a=>{_$(".share-weixin-canvas").appendChild(a)}).catch(()=>{console.error("Failed to generate weixin share image.")})})})});var w=_$("#header > img");w.src||w.style.background?window.bannerElement=w:window.bannerElement=_$("#header > picture img");window.generateSchemeHandler?.();})();
